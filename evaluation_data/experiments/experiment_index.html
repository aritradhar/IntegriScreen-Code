
<!DOCTYPE html>
<html>
<head>
<title>User Study</title>

<script>
mainURL = "http://idvm-infk-capkun01.inf.ethz.ch:8085/generated/bank_transfer.html";
randomStr = "0fhdasjfkhdsajkfhdasjfldashjrjewklrewkjfgahdsjkgfhdsagkfh";

attackCode = "SPFI";

attackArr = [
            "atk_mode=same&atk_type=replace_bunch",
            "atk_mode=parallel&atk_type=replace_bunch",
            "atk_mode=change_focus&atk_type=replace_bunch",
            "atk_mode=inactive&atk_type=replace_bunch"
          ];

numberOfAttacks = 4;  // default number of attacks that we want to test

var c = parseInt(new URL(location.href).searchParams.get("tst")); // check if other number of attacks is set in the URL
if (c > 0)
  numberOfAttacks = c;


function generateLinks() {
  busyCases = "01";  // stores the cases when the next attack cannot happen
  if (document.getElementById("attacksOrder").value.length == 2 + numberOfAttacks) {
    busyCases = document.getElementById("attacksOrder").value;
  }
  nextTarget = 0;
  document.getElementById("linkList").innerHTML = ""; // clear old links if recalled

  for (i = 0; i < numberOfAttacks; i++) {
    if (busyCases.length == 2 + numberOfAttacks)     // if all attack cases are already specified
      break;

    while (busyCases.indexOf(nextTarget) > -1) {
      nextTarget = Math.floor((Math.random() * 8) + 2);
    }
    busyCases += nextTarget;
  }

  console.log("Attacks: " + busyCases);
  document.getElementById("linksHeader").innerHTML = "Random User ID: " + busyCases + "";
  //generate links
  j = 0; // index for attack array
  for (i = 0; i < 10; i++) {
    if (i < 2 || busyCases.indexOf(i) < 0) {    // always exclude the first two cases from attacks
      unique = Math.floor((Math.random() * 100000000) + 100000000);
      link = "<a href=\"" + mainURL + "?step=" + (i + 1) + "&exp=" + randomStr + unique + "\" target=\"_blank\">Transaction #" + (i + 1) + "</a>";
      document.getElementById("linkList").innerHTML += link + "<br><br>";
    }
    else {      // attack happens
      link = "<a href=\"" + mainURL + "?form=" + (i + 1) + "&exp=" + attackCode[j] + randomStr  + unique + attackArr[j] + "\" target=\"_blank\">Transaction #" + (i + 1) + " - Attack</a>";
      // link = "<a>" + i + attackArr[j];
      j++;
      document.getElementById("linkList").innerHTML += link + "<br><br>";
    }
  }
}

</script>

</head>



<body>
  <br><br>
  <input type="text" name="attacksOrder" id= "attacksOrder" onkeydown = "if (event.keyCode == 13) generateLinks()"><br>
  <br>
  <button onclick="generateLinks()">New Participant</button>

  <p id = "linksHeader"></p>

  <p id = "linkList"></p>
</body>


</html>
